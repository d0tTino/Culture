[tool.black]
line-length = 99
target-version = ["py310"]
include = '\.pyi?$'
exclude = '''
/(
    \.git
  | \.venv
  | __pycache__
  | build
  | dist
)/
'''
extend-exclude = "src/agents/core/agent_state.py"

[tool.isort]
profile = "black"
line_length = 99

[tool.ruff]
line-length = 99
# Ruff's autofix is enabled via CLI, but document here for clarity
fix = true
extend-exclude = ["requirements-dev.txt", "src/agents/core/agent_state.py"]
force-exclude = true

[tool.ruff.lint]
select = ["E", "W", "F", "I", "UP", "ANN", "RUF"]
ignore = ["E501", "F841", "ANN401"]

[tool.ruff.lint.flake8-annotations]
mypy-init-return = true
suppress-none-returning = true

[tool.ruff.lint.per-file-ignores]
"src/agents/dspy_programs/*_examples.py" = ["E501"]
"src/agents/dspy_programs/*_summary_examples.py" = ["E501"]
"tests/unit/dspy_programs/test_role_specific_summary_generator.py" = ["E501"]
"src/agents/core/base_agent.py" = ["E501"]
"tests/integration/test_dynamic_role_change.py" = ["E501"]
"tests/integration/**.py" = ["E402"]
"tests/**.py" = ["ANN"]
"src/shared/llm_mocks.py" = ["ANN001", "ANN002", "ANN003", "ANN204"]
"src/agents/core/agent_state.py" = ["E999"]
"src/sim/world_map.py" = ["ANN101"]

[tool.mypy]
python_version = "3.10"
mypy_path = "src:stubs"
disallow_untyped_defs = true
disallow_incomplete_defs = true
disallow_untyped_calls = true
warn_redundant_casts = true
warn_unused_ignores = false
warn_return_any = true
strict_equality = true
no_implicit_optional = true
check_untyped_defs = true
ignore_missing_imports = true
disable_error_code = [
    "misc",
    "name-defined",
    "arg-type",
    "return-value",
    "union-attr",
    "import-untyped",
]
exclude = [
    "\\.venv",
    "build/",
    "tests/",
    "src/agents/core/agent_state.py",
    "src/ollama/.*"
    , "dspy_ai/.*"

]
# Only type-check the application source code for now
files = ["src"]
# Temporarily disable the Pydantic mypy plugin due to compatibility issues
# plugins = ["pydantic.mypy"]
strict = true  # Global strict typing
disallow_any_unimported = false

[[tool.mypy.overrides]]
module = ["src.agents.dspy_programs.*"]
ignore_errors = true

[[tool.mypy.overrides]]
module = [
    "src.agents.graphs.basic_agent_graph",
    "src.sim.graph_knowledge_board",
    "src.sim.simulation",
]
ignore_errors = true

[tool.ruff.format]
preview = false

#[tool.ruff.lint.per-file-ignores] # This line and the following are removed as they are now under [tool.ruff.per-file-ignores]
#"src/agents/dspy_programs/*_examples.py" = ["E501"]
#"src/agents/dspy_programs/*_summary_examples.py" = ["E501"]
#"tests/unit/dspy_programs/test_role_specific_summary_generator.py" = ["E501"] 
